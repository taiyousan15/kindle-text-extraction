# Kindle OCR - Streamlit UI クイックスタート

Kindle書籍自動文字起こしシステムのWeb UIを起動して使用する方法

## 🚀 クイックスタート（3ステップ）

### Step 1: FastAPI バックエンドの起動

ターミナルで以下のコマンドを実行：

```bash
# プロジェクトルートに移動
cd /path/to/Kindle文字起こしツール

# FastAPI サーバーを起動
uvicorn app.main:app --reload
```

**確認:** `http://localhost:8000/docs` にアクセスしてAPI仕様が表示されればOK

### Step 2: Streamlit UI の起動

**方法1: 起動スクリプトを使用（推奨）**

```bash
./run_ui.sh
```

**方法2: 直接起動**

```bash
streamlit run app/ui/Home.py
```

**確認:** ブラウザが自動的に開き、`http://localhost:8501` でUIが表示されればOK

### Step 3: OCR処理を開始

#### 手動OCR（画像アップロード）

1. 左サイドバーから **📤 Upload** ページに移動
2. 画像ファイルをドラッグ&ドロップまたは選択
3. 書籍タイトルとページ番号を入力
4. 「🚀 アップロード & OCR実行」をクリック
5. OCR結果を確認

#### 自動キャプチャ

1. 左サイドバーから **🤖 Auto Capture** ページに移動
2. Amazon認証情報（Email, Password）を入力
3. Kindle Cloud Reader URLを入力
4. 書籍タイトルと最大ページ数を設定
5. 「🚀 キャプチャ開始」をクリック
6. リアルタイムで進捗を確認

## 📊 画面構成

### ホームページ（Home）

![Home Page](docs/images/home.png)

**機能:**
- システム概要
- クイック統計（総ジョブ数、処理ページ数、成功率）
- 最近のジョブ一覧
- システムヘルスチェック

**操作:**
- 🔄 リフレッシュボタンでデータ更新
- サイドバーから各ページに移動

### 📤 Upload（手動OCR）

![Upload Page](docs/images/upload.png)

**機能:**
- 画像ファイルのアップロード
- OCR処理の実行
- 結果の表示とダウンロード

**対応形式:** PNG, JPG, JPEG
**最大サイズ:** 10MB

**使い方:**
1. 画像を選択
2. 書籍タイトルとページ番号を入力
3. アップロードボタンをクリック
4. OCR結果を確認

### 🤖 Auto Capture（自動キャプチャ）

![Auto Capture Page](docs/images/auto_capture.png)

**機能:**
- Kindle Cloud Readerからの自動キャプチャ
- リアルタイム進捗表示
- OCR結果のプレビュー

**必要な情報:**
- Amazon認証情報（Email, Password）
- Kindle Cloud Reader URL
- 書籍タイトル
- 最大ページ数（1-100）

**使い方:**
1. 認証情報とURLを入力
2. キャプチャ開始ボタンをクリック
3. 進捗をリアルタイムで確認
4. 完了後、OCR結果を確認

**ヒント:**
- ヘッドレスモードON: ブラウザを表示せず高速処理
- ヘッドレスモードOFF: ブラウザの動作を確認可能（デバッグ用）

### 📊 Jobs（ジョブ管理）

![Jobs Page](docs/images/jobs.png)

**機能:**
- 全ジョブの一覧表示
- ステータスフィルター
- ジョブ詳細の確認
- CSVエクスポート

**フィルター:**
- すべて
- pending（待機中）
- processing（処理中）
- completed（完了）
- failed（失敗）

**使い方:**
1. フィルターでジョブを絞り込み
2. ジョブカードを展開して詳細を確認
3. OCR結果ボタンでテキストを表示
4. CSVエクスポートでデータをダウンロード

## 🔧 設定とカスタマイズ

### 環境変数

`.env` ファイルで以下を設定できます：

```bash
# FastAPI バックエンドのURL
API_BASE_URL=http://localhost:8000
```

### ポート番号の変更

Streamlit のデフォルトポート（8501）を変更する場合：

```bash
streamlit run app/ui/Home.py --server.port 8080
```

### ブラウザの自動起動を無効化

```bash
streamlit run app/ui/Home.py --server.headless true
```

## 💡 使用例

### 例1: 単一ページのOCR処理

**シナリオ:** Kindleのスクリーンショット1枚をOCR処理したい

1. **準備**
   - Kindleアプリでスクリーンショットを撮影
   - 画像ファイルを保存

2. **Upload ページで処理**
   - 画像をアップロード
   - 書籍タイトル: "プロンプトエンジニアリング入門"
   - ページ番号: 1
   - アップロード & OCR実行

3. **結果の確認**
   - 抽出テキストを確認
   - 信頼度スコアを確認
   - 必要に応じてテキストをダウンロード

**処理時間:** 約5-10秒

### 例2: 複数ページの一括OCR処理

**シナリオ:** Kindle書籍の50ページを自動的にOCR処理したい

1. **準備**
   - Kindle Cloud Readerで書籍を開く
   - ブラウザのURLをコピー

2. **Auto Capture ページで処理**
   - Amazon認証情報を入力
   - Kindle Cloud Reader URLを貼り付け
   - 書籍タイトル: "プロンプトエンジニアリング入門"
   - 最大ページ数: 50
   - ヘッドレスモード: ON
   - キャプチャ開始

3. **進捗の確認**
   - リアルタイムで進捗バーを確認
   - キャプチャ済みページ数を確認
   - 5秒ごとに自動更新

4. **結果の確認**
   - Jobs ページで完了ジョブを確認
   - OCR結果を表示
   - CSVでエクスポート

**処理時間:** 約5-8分（50ページの場合）

### 例3: ジョブのステータス確認とエクスポート

**シナリオ:** 過去のOCRジョブを確認してデータをエクスポートしたい

1. **Jobs ページを開く**
   - 左サイドバーから「📊 Jobs」に移動

2. **ジョブの絞り込み**
   - ステータスフィルター: "completed"
   - 表示件数: 20

3. **ジョブ詳細の確認**
   - ジョブカードを展開
   - ジョブIDとステータスを確認
   - OCR結果ボタンをクリック
   - 各ページのテキストを確認

4. **データのエクスポート**
   - 「📥 CSV ダウンロード」ボタンをクリック
   - ファイルを保存: `kindle_ocr_jobs_20251028_143000.csv`

## 🐛 トラブルシューティング

### エラー: "API接続エラー"

**原因:** FastAPI サーバーが起動していない

**解決方法:**
```bash
# FastAPI サーバーを起動
uvicorn app.main:app --reload

# 起動確認
curl http://localhost:8000/health
```

### エラー: "ファイルサイズが大きすぎます"

**原因:** 画像ファイルが10MBを超えている

**解決方法:**
- 画像を圧縮する
- 解像度を下げる
- 別の画像形式に変換

### エラー: "OCR処理に失敗しました"

**原因:** 画像の品質が低い、または文字が不鮮明

**解決方法:**
- 高解像度の画像を使用
- 鮮明なスクリーンショットを撮影
- 画像が傾いていないか確認

### エラー: "自動キャプチャが失敗しました"

**原因:** Amazon認証エラー、またはネットワークエラー

**解決方法:**
1. Amazon認証情報を確認
2. Kindle Cloud Reader URLを確認
3. ヘッドレスモードをOFFにして動作を確認
4. ネットワーク接続を確認

### ページが読み込まれない

**原因:** Streamlitが起動していない、またはポート競合

**解決方法:**
```bash
# Streamlitプロセスを確認
ps aux | grep streamlit

# ポート8501を使用しているプロセスを確認
lsof -i :8501

# 別のポートで起動
streamlit run app/ui/Home.py --server.port 8502
```

## 📈 パフォーマンス最適化

### 大量ページの処理

**推奨設定:**
- ヘッドレスモード: ON
- 最大ページ数: 50以下（初回）
- ネットワーク: 安定した接続

**処理時間の目安:**
- 10ページ: 約1-2分
- 50ページ: 約5-8分
- 100ページ: 約10-15分

### メモリ使用量の削減

- ジョブ一覧の表示件数を調整（20件以下推奨）
- 不要なジョブを削除（今後実装予定）
- ブラウザのキャッシュをクリア

## 🔐 セキュリティ

### Amazon認証情報の取り扱い

- パスワードは `type="password"` で隠蔽
- セッション終了後は自動クリア
- データベースには保存されない（処理時のみ使用）

### 推奨事項

- 本番環境ではHTTPSを使用
- ファイアウォールでポートを制限
- 定期的にパスワードを変更

## 📚 関連ドキュメント

- [QUICKSTART_OCR.md](QUICKSTART_OCR.md) - OCR機能の詳細
- [QUICKSTART_CAPTURE.md](QUICKSTART_CAPTURE.md) - 自動キャプチャの詳細
- [app/ui/README.md](app/ui/README.md) - UI技術仕様
- [DEVELOPMENT_PLAN.md](DEVELOPMENT_PLAN.md) - 開発計画

## 🤝 サポート

質問やバグ報告は、GitHubのIssueでお知らせください。

---

**📚 Kindle OCR v1.0.0 (Phase 1-6 MVP)**
Powered by FastAPI, Streamlit, Tesseract OCR
